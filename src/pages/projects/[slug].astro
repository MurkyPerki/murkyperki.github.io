---
import Layout from "../../layouts/Layout.astro";
import { getCollection, type CollectionEntry } from "astro:content";

export async function getStaticPaths() {
  const projects = await getCollection("projects");
  return projects.map((p, index) => {
    const prevProject = index > 0 ? projects[index - 1] : null;
    const nextProject = index < projects.length - 1 ? projects[index + 1] : null;
    return {
      params: { slug: p.slug },
      props: { p, prevProject, nextProject }
    };
  });
}

const { p, prevProject, nextProject } = Astro.props as {
  p: CollectionEntry<"projects">;
  prevProject: CollectionEntry<"projects"> | null;
  nextProject: CollectionEntry<"projects"> | null;
};
const { Content } = await p.render();
---

<Layout title={`${p.data.title} ‚Äî Max Burkhardt`} description={p.data.pitch || p.data.title}>
  <article class="container-narrow" style="padding: var(--spacing-xl) var(--spacing-md);">
    <!-- Cover Image (if present) -->
    {p.data.cover && (
      <div class="reveal" style="margin-bottom: var(--spacing-xl);">
        <img 
          src={p.data.cover} 
          alt={p.data.title}
          style="width: 100%; aspect-ratio: 16/9; object-fit: cover; border-radius: 8px; border: 1px solid var(--color-border);"
        />
      </div>
    )}
    
    <!-- Header -->
    <header class="reveal" style="margin-bottom: var(--spacing-xl);">
      <h1 style="margin-bottom: var(--spacing-xs);">{p.data.title}</h1>
      {p.data.role && (
        <p class="text-muted text-lg" style="margin-bottom: var(--spacing-md);">{p.data.role}</p>
      )}
      {p.data.pitch && (
        <p class="text-lg" style="line-height: 1.7;">{p.data.pitch}</p>
      )}
    </header>

    <!-- Highlights -->
    {p.data.highlights && p.data.highlights.length > 0 && (
      <section class="reveal" style="margin-bottom: var(--spacing-xl);">
        <h2>Highlights</h2>
        <ul style="list-style: none; padding: 0;">
          {p.data.highlights.map((h) => (
            <li style="padding: var(--spacing-sm) 0; border-bottom: 1px solid var(--color-border);">
              ‚ú® {h}
            </li>
          ))}
        </ul>
      </section>
    )}

    <!-- Media Links -->
    {p.data.media && p.data.media.length > 0 && (
      <section class="reveal" style="margin-bottom: var(--spacing-xl);">
        <h2>Media & Demos</h2>
        <div class="grid">
          {p.data.media.map((m) => (
            <a href={m.href} target="_blank" rel="noopener noreferrer" class="card">
              <h3 style="font-size: 1.125rem;">{m.label}</h3>
              <p class="text-muted" style="font-size: 0.875rem; margin: 0;">View ‚Üí</p>
            </a>
          ))}
        </div>
      </section>
    )}

    <!-- Code & Links -->
    {p.data.links && p.data.links.length > 0 && (
      <section class="reveal" style="margin-bottom: var(--spacing-xl);">
        <h2>Code & Links</h2>
        <div class="grid">
          {p.data.links.map((l) => (
            <a href={l.href} target="_blank" rel="noopener noreferrer" class="card">
              <h3 style="font-size: 1.125rem;">{l.label}</h3>
              <p class="text-muted" style="font-size: 0.875rem; margin: 0;">Open ‚Üí</p>
            </a>
          ))}
        </div>
      </section>
    )}

    <!-- Lessons Learned -->
    {p.data.lessons && p.data.lessons.length > 0 && (
      <section class="reveal" style="margin-bottom: var(--spacing-xl);">
        <h2>Lessons Learned</h2>
        <ul style="list-style: none; padding: 0;">
          {p.data.lessons.map((l) => (
            <li style="padding: var(--spacing-sm) 0; border-bottom: 1px solid var(--color-border);">
              üí° {l}
            </li>
          ))}
        </ul>
      </section>
    )}

    <!-- About Section with Markdown Content -->
    <section class="reveal" style="margin-bottom: var(--spacing-xl);">
      <h2>About</h2>
      <div class="prose" style="line-height: 1.7;">
        <Content />
      </div>
    </section>

    <!-- Previous/Next Navigation -->
    <nav class="reveal" style="display: flex; justify-content: space-between; padding-top: var(--spacing-lg); border-top: 1px solid var(--color-border); margin-top: var(--spacing-xl);">
      {prevProject ? (
        <a href={`/projects/${prevProject.slug}/`} style="color: var(--color-accent); text-decoration: none; font-weight: 600;">
          ‚Üê {prevProject.data.title}
        </a>
      ) : (
        <span></span>
      )}
      
      {nextProject && (
        <a href={`/projects/${nextProject.slug}/`} style="color: var(--color-accent); text-decoration: none; font-weight: 600; text-align: right;">
          {nextProject.data.title} ‚Üí
        </a>
      )}
    </nav>

    <!-- Back to Projects -->
    <div class="reveal" style="text-align: center; margin-top: var(--spacing-lg);">
      <a href="/projects" style="color: var(--color-muted); text-decoration: none; font-weight: 500;">
        ‚Üê Back to all projects
      </a>
    </div>
  </article>
  
  <style>
    .prose p {
      margin-bottom: var(--spacing-md);
    }
    
    .prose ul, .prose ol {
      margin-bottom: var(--spacing-md);
      padding-left: 1.5rem;
    }
    
    .prose li {
      margin-bottom: var(--spacing-xs);
    }
    
    .prose h2, .prose h3 {
      margin-top: var(--spacing-lg);
      margin-bottom: var(--spacing-sm);
    }
    
    .prose code {
      background: var(--color-card-hover);
      padding: 0.125rem 0.375rem;
      border-radius: 4px;
      font-size: 0.875em;
    }
  </style>
</Layout>
